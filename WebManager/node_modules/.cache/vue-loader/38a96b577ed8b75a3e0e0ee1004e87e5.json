{"remainingRequest":"I:\\Project\\CampusPost-GraduationProject\\WebManager\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!I:\\Project\\CampusPost-GraduationProject\\WebManager\\src\\components\\manage\\ClassDistribution.vue?vue&type=style&index=0&id=314f2ce2&scoped=true&lang=css&","dependencies":[{"path":"I:\\Project\\CampusPost-GraduationProject\\WebManager\\src\\components\\manage\\ClassDistribution.vue","mtime":1627198309543},{"path":"I:\\Project\\CampusPost-GraduationProject\\WebManager\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"I:\\Project\\CampusPost-GraduationProject\\WebManager\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"I:\\Project\\CampusPost-GraduationProject\\WebManager\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"I:\\Project\\CampusPost-GraduationProject\\WebManager\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"I:\\Project\\CampusPost-GraduationProject\\WebManager\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLnN0ZXBGb3JtIHsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KICBtYXJnaW4tdG9wOiA2NHB4Ow0KfQ0KDQoudGFncyB7DQogIG1hcmdpbi10b3A6IDEycHg7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgbWFyZ2luLWJvdHRvbTogMTJweDsNCn0NCg0KLmVsLXRhZyArIC5lbC10YWcgew0KICBtYXJnaW4tbGVmdDogMTBweDsNCn0NCg0KLmJ1dHRvbi1uZXctdGFnIHsNCiAgbWFyZ2luLWxlZnQ6IDEwcHg7DQogIGhlaWdodDogMzJweDsNCiAgbGluZS1oZWlnaHQ6IDMwcHg7DQogIHBhZGRpbmctdG9wOiAwOw0KICBwYWRkaW5nLWJvdHRvbTogMDsNCn0NCg0KLmlucHV0LW5ldy10YWcgew0KICB3aWR0aDogOTBweDsNCiAgbWFyZ2luLWxlZnQ6IDEwcHg7DQogIHZlcnRpY2FsLWFsaWduOiBib3R0b207DQp9DQoNCi5zdGVwRm9ybTMgew0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQo="},{"version":3,"sources":["ClassDistribution.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgRA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"ClassDistribution.vue","sourceRoot":"src/components/manage","sourcesContent":["<template>\r\n  <div>\r\n    <el-breadcrumb separator-class=\"el-icon-arrow-right\">\r\n      <el-breadcrumb-item>首页</el-breadcrumb-item>\r\n      <el-breadcrumb-item>班级管理</el-breadcrumb-item>\r\n      <el-breadcrumb-item>班级分配</el-breadcrumb-item>\r\n    </el-breadcrumb>\r\n\r\n    <el-card>\r\n      <el-steps :active=\"step_active\" finish-status=\"success\">\r\n        <el-step title=\"选择班级\"></el-step>\r\n        <el-step title=\"添加学生\"></el-step>\r\n        <el-step title=\"确认添加\"></el-step>\r\n      </el-steps>\r\n      <div class=\"stepForm\" v-show=\"step_active === 0\">\r\n        <el-form :model=\"collegeInfoForm\" :rules=\"collegeInfoFormRules\" ref=\"dormitoryInfoFormRef\">\r\n          <el-form-item label-width=\"350\">\r\n            请选择学院：\r\n            <el-select v-model=\"selectCollege_id\" placeholder=\"请选择学院\" @change=\"onCollegeSelect\">\r\n              <el-option\r\n                v-for=\"item in collegeList\"\r\n                :key=\"item.value\"\r\n                :label=\"item.label\"\r\n                :value=\"item.value\">\r\n              </el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item label-width=\"350\">\r\n            请选择班级：\r\n            <el-select v-model=\"collegeInfoForm.class_id\" placeholder=\"请选择班级\">\r\n              <el-option\r\n                v-for=\"item in classList\"\r\n                :key=\"item.class_id\"\r\n                :label=\"item.class_name\"\r\n                :value=\"item.class_id\">\r\n              </el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n        </el-form>\r\n      </div>\r\n      <div class=\"stepForm\" v-show=\"step_active === 1\">\r\n        <div class=\"tags\">\r\n          <el-tag\r\n            class=\"tags\"\r\n            :key=\"tag.key\"\r\n            v-for=\"tag in studentsTags\"\r\n            closable\r\n            :disable-transitions=\"false\"\r\n            @close=\"handleClose(tag)\">\r\n            {{ tag.name }}\r\n          </el-tag>\r\n          <el-button class=\"button-new-tag\" size=\"small\" v-show=\"studentsTags.length < 8\"\r\n                     @click=\"addStuDialogVisible = true\">+ New Tag\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n      <div class=\"stepForm3\" v-show=\"step_active === 2\">\r\n        <h4>确定要修改班级为以下学生吗？</h4>\r\n        <span v-for=\"item in studentsTags\" :key=\"item.account_id\">&nbsp;&nbsp;{{ item.name }}&nbsp;&nbsp;</span>\r\n      </div>\r\n      <div class=\"stepForm3\" v-show=\"step_active === 3\">\r\n        <h4>最后的确认</h4>\r\n      </div>\r\n      <div class=\"stepForm\">\r\n        <el-button @click=\"prev\"\r\n                   v-if=\"step_active >= 1 && step_active <= 3\">\r\n          上一步\r\n        </el-button>\r\n        <el-button @click=\"next\" type=\"primary\" v-if=\"\r\n        ((step_active === 0) && (collegeInfoForm.class_id !== null)) || (step_active === 1) || step_active === 2\">\r\n          下一步\r\n        </el-button>\r\n        <el-button type=\"primary\" @click=\"submit\" v-if=\"step_active === 3\">提交</el-button>\r\n      </div>\r\n    </el-card>\r\n    <el-dialog\r\n      title=\"添加学生信息\"\r\n      :visible.sync=\"addStuDialogVisible\"\r\n      width=\"30%\"\r\n      @close=\"dialogClose\">\r\n      <el-form :model=\"ClassInfoForm\" ref=\"dormitoryInfoFormRef\">\r\n        <el-form-item label-width=\"350\">\r\n          请选择学院：\r\n          <el-select v-model=\"DialogSelectCollege_id\" placeholder=\"请选择学院\" @change=\"onCollegeSelectChange\">\r\n            <el-option\r\n              v-for=\"item in collegeList\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\">\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label-width=\"350\">\r\n          请选择学生：\r\n          <el-select v-model=\"studentInfoForm.selected_student\" placeholder=\"请选择学生\">\r\n            <el-option\r\n              v-for=\"item in dialogStudentsList\"\r\n              :key=\"item.account_id\"\r\n              :label=\"item.turename\"\r\n              :value=\"item.account_id\">\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"addStuDialogVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"addStuConfirm\"\r\n                   :disabled=\"studentInfoForm.selected_student === null\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'ClassDistribution',\r\n  data () {\r\n    return {\r\n      step_active: 0,\r\n      collegeInfoForm: {\r\n        class_id: null\r\n      },\r\n      collegeInfoFormRules: {},\r\n      selectCollege_id: null,\r\n      DialogSelectCollege_id: null,\r\n      collegeList: [{\r\n        value: 1,\r\n        label: '电子与信息学院'\r\n      }, {\r\n        value: 2,\r\n        label: '经济与贸易学院'\r\n      }, {\r\n        value: 3,\r\n        label: '世博艺术与传媒学院'\r\n      }, {\r\n        value: 4,\r\n        label: '建筑工程与管理学院'\r\n      }, {\r\n        value: 5,\r\n        label: '电商与物流学院'\r\n      }, {\r\n        value: 6,\r\n        label: '会计与金融学院'\r\n      }],\r\n      classList: [],\r\n      dialogClassList: [],\r\n      // tag标签对线，储存姓名和Id\r\n      studentsTags: [],\r\n      // tag中的学生Id，单独储存为一个list\r\n      studentTagsIds: [0, 1],\r\n      // 新增的学生Id\r\n      addStudentIds: [],\r\n      // 从班级中移除的学生Id\r\n      dropStudents: [],\r\n      // 添加学生的Dialog显示与否\r\n      addStuDialogVisible: false,\r\n      // Dialog表单中的信息\r\n      ClassInfoForm: {\r\n        college_id: null,\r\n        class_id: null\r\n      },\r\n      dialogStudentsList: [],\r\n      studentInfoForm: {\r\n        selected_student: null\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    prev () {\r\n      --this.step_active\r\n    },\r\n    next () {\r\n      if (++this.step_active > 3) {\r\n        this.step_active = 0\r\n        this.nextBtn = '下一步'\r\n      }\r\n      if (this.step_active === 1) {\r\n        this.studentsTags = []\r\n        this.studentTagsIds = [0, 1]\r\n        // 获取教室已有的学生\r\n        this.getClassStudents()\r\n      }\r\n    },\r\n    async onCollegeSelect () {\r\n      this.collegeInfoForm.class_id = null\r\n      const { data: res } = await this.$http.get('/collegeClass/getCollegeClass', { params: { college_id: this.selectCollege_id } })\r\n      console.log(res)\r\n      this.classList = res.data\r\n    },\r\n    async getClassStudents () {\r\n      const { data: res } = await this.$http.get('/student/getClassStudentList', { params: { class_id: this.collegeInfoForm.class_id } })\r\n      for (let j = 0; j < res.data.length; j++) {\r\n        this.studentsTags.push({\r\n          account_id: res.data[j].account_id,\r\n          name: res.data[j].turename\r\n        })\r\n        this.studentTagsIds.push(res.data[j].account_id)\r\n      }\r\n    },\r\n    dialogClose () {\r\n      this.DialogSelectCollege_id = null\r\n      this.studentInfoForm.selected_student = null\r\n    },\r\n    // async getCollegeClassList () {\r\n    //   const { data: res } = await this.$http.get('/collegeClass/getCollegeClass', { params: { college_id: this.DialogSelectCollege_id } })\r\n    //   this.dialogClassList = res.data\r\n    // },\r\n    async onCollegeSelectChange () {\r\n      this.studentInfoForm.selected_student = null\r\n      const { data: res } = await this.$http.post('/student/getCollegeStudentListNotIn', {\r\n        college_id: this.DialogSelectCollege_id,\r\n        ids: this.studentTagsIds\r\n      })\r\n      console.log(res)\r\n      if (res.code !== 200) this.$message.error(res.msg)\r\n      this.dialogStudentsList = res.data\r\n    },\r\n    async addStuConfirm () {\r\n      if (this.dropStudents.indexOf(this.studentInfoForm.selected_student) === -1) {\r\n        this.addStudentIds.push(this.studentInfoForm.selected_student)\r\n      } else {\r\n        this.dropStudents.splice(this.dropStudents.indexOf(this.studentInfoForm.selected_student), 1)\r\n      }\r\n      const { data: res } = await this.$http.get('/student/getStudentByAccountId', { params: { account_id: this.studentInfoForm.selected_student } })\r\n      this.studentsTags.push({\r\n        account_id: this.studentInfoForm.selected_student,\r\n        name: res.data.turename\r\n      })\r\n      this.studentTagsIds.push(this.studentInfoForm.selected_student)\r\n      this.addStuDialogVisible = false\r\n      console.log('新增的学生')\r\n      console.log(this.addStudentIds)\r\n      console.log('删除的学生')\r\n      console.log(this.dropStudents)\r\n      console.log('已经选中的学生')\r\n      console.log(this.studentTagsIds)\r\n    },\r\n    handleClose (tag) {\r\n      if (this.addStudentIds.indexOf(tag.account_id) === -1) {\r\n        this.dropStudents.push(tag.account_id)\r\n      } else {\r\n        this.addStudentIds.splice(this.addStudentIds.indexOf(tag.account_id), 1)\r\n      }\r\n      this.studentsTags.splice(this.studentsTags.indexOf(tag), 1)\r\n      this.studentTagsIds.splice(this.studentTagsIds.indexOf(tag.account_id), 1)\r\n      console.log('新增的学生')\r\n      console.log(this.addStudentIds)\r\n      console.log('删除的学生')\r\n      console.log(this.dropStudents)\r\n      console.log('已经选中的学生')\r\n      console.log(this.studentTagsIds)\r\n    },\r\n    async submit () {\r\n      const { data: res } = await this.$http.post('/student/changeClass', {\r\n        class_id: this.collegeInfoForm.class_id,\r\n        dropIds: this.dropStudents,\r\n        addIds: this.addStudentIds\r\n      })\r\n      if (res.code !== 200) return this.$message.error(res.msg)\r\n      this.$message.success(res.msg)\r\n      this.step_active = 0\r\n      this.collegeInfoForm.class_id = null\r\n      this.studentTagsIds = [0, 1]\r\n      this.addStudentIds = []\r\n      this.dropStudents = []\r\n      this.dialogStudentsList = []\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.stepForm {\r\n  text-align: center;\r\n  margin-top: 64px;\r\n}\r\n\r\n.tags {\r\n  margin-top: 12px;\r\n  text-align: center;\r\n  margin-bottom: 12px;\r\n}\r\n\r\n.el-tag + .el-tag {\r\n  margin-left: 10px;\r\n}\r\n\r\n.button-new-tag {\r\n  margin-left: 10px;\r\n  height: 32px;\r\n  line-height: 30px;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n}\r\n\r\n.input-new-tag {\r\n  width: 90px;\r\n  margin-left: 10px;\r\n  vertical-align: bottom;\r\n}\r\n\r\n.stepForm3 {\r\n  text-align: center;\r\n}\r\n</style>\r\n"]}]}